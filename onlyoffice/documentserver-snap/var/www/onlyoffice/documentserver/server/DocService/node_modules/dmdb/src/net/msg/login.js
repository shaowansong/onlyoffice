"use strict";

var __extends = this && this.__extends || function() {
    var h = function(t, s) {
        return (h = Object.setPrototypeOf || {
            __proto__: []
        } instanceof Array && function(t, s) {
            t.__proto__ = s;
        } || function(t, s) {
            for (var i in s) s.hasOwnProperty(i) && (t[i] = s[i]);
        })(t, s);
    };
    return function(t, s) {
        function i() {
            this.constructor = t;
        }
        h(t, s), t.prototype = null === s ? Object.create(s) : (i.prototype = s.prototype, 
        new i());
    };
}();

Object.defineProperty(exports, "__esModule", {
    value: !0
});

var msg_1 = require("./msg"), const_1 = require("../../desc/const"), connection_1 = require("../../driver/connection"), bufferUtil_1 = require("../../utils/bufferUtil"), error_1 = require("../../driver/error"), rsaCipher_1 = require("../../security/rsaCipher"), Login = function(h) {
    function n(t, s) {
        var i = h.call(this, t, msg_1.Msg.Ms, null, s) || this;
        return i.ls = !1, i.at = t.at, i;
    }
    return __extends(n, h), n.prototype.te = function() {
        var t = this.at.getServerEncoding();
        this.mt.v(n.Hs, this.at.newClientType ? const_1.Const.SESS3_CLT_NODE : const_1.Const.SESS3_CLT_JDBC), 
        this.mt.v(n.Fs, connection_1.Connection.node2dbIsoLevel(this.at.isoLevel)), this.mt.v(n.Ss, this.at.conn_prop_locale), 
        this.mt.y(n.gs, this.at.conn_prop_localTimezone), this.mt.l(n.qs, this.at.readOnly ? const_1.Const.TRX_ACCESS_MODE_READ_ONLY : const_1.Const.TRX_ACCESS_MODE_READ_WRITE), 
        this.mt.v(n.Ds, this.at.conn_prop_sessionTimeout), this.mt.l(n.Os, this.at.conn_prop_mppLocal ? 1 : 0), 
        this.mt.l(n.Ys, this.at.conn_prop_rwSeparate ? 1 : 0), this.mt.l(n.ms, this.at.newLobFlag ? 1 : 0), 
        this.mt.l(n.As, this.at.conn_prop_osAuthType), this.vs.ct;
        var s, i = bufferUtil_1.BufferUtil.b(this.at.conn_prop_user, t), h = bufferUtil_1.BufferUtil.b(this.at.conn_prop_pwd, t);
        if (i.length > const_1.Const.MAX_NAME_LEN) throw error_1.DBError.ECJS_USERNAME_TOO_LONG();
        if (h.length > const_1.Const.MAX_NAME_LEN) throw error_1.DBError.ECJS_PASSWORD_TOO_LONG();
        this.vs.ot && this.at.conn_prop_loginCertificate ? (i = (s = new rsaCipher_1.RSACipher(this.at.conn_prop_loginCertificate)).encrypt(i), 
        h = s.encrypt(h)) : this.vs.ot && (i = this.vs.bt.encrypt(i, !1), h = this.vs.bt.encrypt(h, !1)), 
        this.mt.Ln(i), this.mt.Ln(h), this.mt.Vn(this.at.conn_prop_appName, t), this.mt.Vn(this.at.conn_prop_osName, t), 
        this.mt.Vn(const_1.Const.HOST_NAME, t), this.mt.In(this.at.rwStandby ? 1 : 0);
    }, n.prototype.ee = function() {
        var t = this.at.getServerEncoding();
        this.at.maxRowSize = this.mt.t(n.ws), this.at.ddlAutoCommit = 1 == this.mt.e(n.xs), 
        this.at.isoLevel = connection_1.Connection.db2nodeIsoLevel(this.mt.t(n.Is)), this.at.conn_prop_caseSensitive = 1 == this.mt.e(n.Ts), 
        this.mt.e(n.Us), this.at.svrStat = this.mt.r(n.Zs), this.at.svrMode = this.mt.r(n.js), 
        this.at.constParaOpt = 1 == this.mt.e(n.Cs), this.at.dbTimezone = this.mt.r(n.Ns), 
        this.at.newLobFlag = 1 == this.mt.e(n.Ls), 0 === this.at.conn_prop_bufPrefetch && (this.at.conn_prop_bufPrefetch = this.mt.t(n.ks)), 
        this.mt.r(n.zs), this.at.dscControl = 1 === this.mt.e(n.Bs), this.mt.Pn(t);
        var s, i = this.mt.N();
        return 0 === i && 0 < this.at.msgVersion ? this.at.schema = this.at.conn_prop_user.toUpperCase() : this.at.schema = this.mt.xn(i, t), 
        this.mt.Pn(t), this.mt.Pn(t), this.mt.N(), this.mt.N(), this.mt.N(), this.at.guid = this.mt.Pn(t), 
        this.mt.Pn(t), 1 === this.mt.e(n.Es) && (this.at.standbyHost = this.mt.Pn(t), this.at.standbyPort = this.mt.N(), 
        this.at.standbyCount = this.mt.x()), 0 < this.mt.Zt() && (this.at.sessionID = this.mt.Un()), 
        0 < this.mt.Zt() && 1 == this.mt.un() && (this.at.formatDate = "DD-MON-YY", this.at.formatTime = "HH12.MI.SS.FF6 AM", 
        this.at.formatTimestamp = "DD-MON-YY HH12.MI.SS.FF6 AM", this.at.formatTimestampTZ = "DD-MON-YY HH12.MI.SS.FF6 AM +TZH:TZM", 
        this.at.formatTimeTZ = "HH12.MI.SS.FF6 AM +TZH:TZM"), 0 < this.mt.Zt() && ((s = this.mt.Sn(t)) && (this.at.formatDate = s), 
        (s = this.mt.Sn(t)) && (this.at.formatTime = s), (s = this.mt.Sn(t)) && (this.at.formatTimestamp = s), 
        (s = this.mt.Sn(t)) && (this.at.formatTimestampTZ = s), (s = this.mt.Sn(t)) && (this.at.formatTimeTZ = s)), 
        this.at;
    }, n.Hs = msg_1.Msg.os, n.Fs = n.Hs + const_1.Const.ULINT_SIZE, n.Ss = n.Fs + const_1.Const.ULINT_SIZE, 
    n.qs = n.Ss + const_1.Const.ULINT_SIZE, n.gs = n.qs + const_1.Const.BYTE_SIZE, n.Ds = n.gs + const_1.Const.USINT_SIZE, 
    n.Os = n.Ds + const_1.Const.ULINT_SIZE, n.Ys = n.Os + const_1.Const.BYTE_SIZE, n.ms = n.Ys + const_1.Const.BYTE_SIZE, 
    n.As = n.ms + const_1.Const.BYTE_SIZE, n.Gs = (n.ws = n.os) + const_1.Const.ULINT_SIZE, 
    n.xs = n.Gs + const_1.Const.ULINT_SIZE, n.Is = n.xs + const_1.Const.BYTE_SIZE, n.Ts = n.Is + const_1.Const.ULINT_SIZE, 
    n.Us = n.Ts + const_1.Const.BYTE_SIZE, n.js = n.Us + const_1.Const.BYTE_SIZE, n.Zs = n.js + const_1.Const.USINT_SIZE, 
    n.Cs = n.Zs + const_1.Const.USINT_SIZE, n.Ns = n.Cs + const_1.Const.BYTE_SIZE, n.Es = n.Ns + const_1.Const.USINT_SIZE, 
    n.Ls = n.Es + const_1.Const.BYTE_SIZE, n.ks = n.Ls + const_1.Const.BYTE_SIZE, n.zs = n.ks + const_1.Const.ULINT_SIZE, 
    n.Bs = n.zs + const_1.Const.USINT_SIZE, n;
}(msg_1.Msg);

exports.Login = Login;