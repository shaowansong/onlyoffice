"use strict";

var __extends = this && this.__extends || function() {
    var i = function(t, e) {
        return (i = Object.setPrototypeOf || {
            __proto__: []
        } instanceof Array && function(t, e) {
            t.__proto__ = e;
        } || function(t, e) {
            for (var s in e) e.hasOwnProperty(s) && (t[s] = e[s]);
        })(t, e);
    };
    return function(t, e) {
        function s() {
            this.constructor = t;
        }
        i(t, e), t.prototype = null === e ? Object.create(e) : (s.prototype = e.prototype, 
        new s());
    };
}();

Object.defineProperty(exports, "__esModule", {
    value: !0
});

var execute_1 = require("./execute"), msg_1 = require("./msg"), const_1 = require("../../desc/const"), executeRetInfo_1 = require("../../desc/executeRetInfo"), parameter_1 = require("../../desc/parameter"), dbtype_1 = require("../../driver/dbtype"), typeDescriptor_1 = require("../../desc/typeDescriptor"), Prepare = function(n) {
    function t(t, e, s, i, r) {
        var h = n.call(this, t, msg_1.Msg.Ni, e, r) || this;
        return h.pe = s, h.ye = i, h;
    }
    return __extends(t, n), t.prototype.te = function() {
        var t = this.vs.at, e = this.ir, s = msg_1.Msg.os;
        s += this.mt.l(s, t.conn_prop_autoCommit ? 1 : 0), s += this.mt.l(s, this.pe ? 1 : 0), 
        s += this.mt.l(s, 0), s += this.mt.l(s, 1), s += this.mt.l(s, t.compatibleOracle() ? 0 : 1), 
        s += this.mt.y(s, this.ye), s += this.mt.U(s, e.maxRows <= 0 || t.conn_prop_enRsCache ? const_1.Const.INT64_MAX : e.maxRows), 
        s += this.mt.l(s, t.conn_prop_isBdtaRS ? const_1.Const.RS_BDTA : const_1.Const.RS_ROW), 
        s += this.mt.y(s, 0), s += this.mt.l(s, 1), s += this.mt.l(s, 0), s += this.mt.l(s, 0), 
        s += this.mt.v(s, e.queryTimeout), this.mt.l(s, e.innerExec ? 1 : 0), this.mt.Xn(e.nativeSql, t.getServerEncoding());
    }, t.prototype.ee = function() {
        if (this.pe) return n.prototype.ee.call(this);
        var t = new executeRetInfo_1.ExecuteRetInfo(), e = this.vs.at, s = msg_1.Msg.os;
        t.retSqlType = this.mt.r(s), s += const_1.Const.USINT_SIZE;
        var i = this.mt.oi(s);
        s += const_1.Const.USINT_SIZE;
        var r = this.mt.r(s);
        return s += const_1.Const.USINT_SIZE, this.mt.n(s), s += const_1.Const.DDWORD_SIZE, 
        e.trxStatus = this.mt.t(s), const_1.Const.ULINT_SIZE, 0 < i ? (this.ir.params = this.qe(i), 
        this.ir.paramCount = i) : (this.ir.params = new Array(0), this.ir.paramCount = 0), 
        this.ir.columns = 0 < r ? this.cs(r, t.rsBdta) : new Array(0), t;
    }, t.prototype.qe = function(t) {
        for (var e, s, i, r, h = new Array(t), n = 0; n < t; n++) {
            var c = new parameter_1.Parameter();
            c.type = this.mt.N(), c.prec = this.mt.N(), c.scale = this.mt.N(), c.nullable = 0 != this.mt.N();
            var u = this.mt.hn();
            c.typeFlag = 0 != (u & execute_1.Execute.ds) ? parameter_1.Parameter.TYPE_FLAG_RECOMMEND : parameter_1.Parameter.TYPE_FLAG_EXACT, 
            c.lob = 0 != (u & execute_1.Execute.ps), this.mt.N(), c.ioType = this.mt.hn(), e = this.mt.hn(), 
            s = this.mt.hn(), i = this.mt.hn(), r = this.mt.hn(), c.name = this.mt.xn(e, this.vs.at.getServerEncoding()), 
            c.typeName = this.mt.xn(s, this.vs.at.getServerEncoding()), c.tableName = this.mt.xn(i, this.vs.at.getServerEncoding()), 
            c.schemaName = this.mt.xn(r, this.vs.at.getServerEncoding()), c.lob && (c.lobTabId = this.mt.N(), 
            c.lobColId = this.mt.hn()), h[n] = c;
        }
        for (var _, n = 0; n < t; n++) {
            dbtype_1.DBType.isComplexType(h[n].type, h[n].scale) && ((_ = new typeDescriptor_1.TypeDescriptor(this.vs.at)).unpack(this.mt), 
            h[n].typeDescriptor = _);
        }
        return h;
    }, t;
}(execute_1.Execute);

exports.Prepare = Prepare;